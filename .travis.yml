###############################################################################
#                                                                             #
# Copyright (C) 2019 Troels Schwarz-Linnet                                    #
# Copyright (C) 2019 Edward d'Auvergne                                        #
#                                                                             #
# This file is part of the program relax (http://www.nmr-relax.com).          #
#                                                                             #
# This program is free software: you can redistribute it and/or modify        #
# it under the terms of the GNU General Public License as published by        #
# the Free Software Foundation, either version 3 of the License, or           #
# (at your option) any later version.                                         #
#                                                                             #
# This program is distributed in the hope that it will be useful,             #
# but WITHOUT ANY WARRANTY; without even the implied warranty of              #
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               #
# GNU General Public License for more details.                                #
#                                                                             #
# You should have received a copy of the GNU General Public License           #
# along with this program.  If not, see <http://www.gnu.org/licenses/>.       #
#                                                                             #
###############################################################################

language: python

env:
  global:
    - API_BUILD=false
    - FSFCV=false
    - MPI=false
    - OLD_PY2_PACKAGES=false
    - TEST=true
    - UPGRADE=false
    - WXPYTHON=false
    - PYTHON=""

matrix:
  include:
    # Arm64 Linux (Ubuntu Bionic 18.04), Python 3.6 (system).
    - name: "Arm64 Linux (Ubuntu 18.04), Python 3.6 (system), single processor, all tests."
      python: 3.6
      language: python
      os: linux
      arch: arm64
      dist: bionic
      env:
        - PYTHON="/usr/bin/python3"
      before_install:
        - sudo apt-get -y install python3-pip
        - sudo apt-get -y install python3-numpy
        - sudo apt-get -y install python3-matplotlib
        - sudo apt-get -y install python3-scipy
        - sudo apt-get -y install python3-mpi4py
        - sudo apt-get -y install scons
      install:
        - /usr/bin/python --version
        - /usr/bin/python3 --version
        - /usr/bin/pip3 --version
        - export PATH=/usr/bin:$PATH
        - /usr/bin/pip3 install -r devel_scripts/travis-ci/requirements.txt
        - /usr/bin/python3 /usr/bin/scons

script:
    # Fail on first error.
    - set -e

    # relax information printout.
    - if [[ $MPI == "false" && $TEST == "true" ]]; then $PYTHON ./relax -i; fi

    # Single processor test suite execution.
    - if [[ $MPI == "false" && $WXPYTHON == "false" && $TEST == "true" ]]; then $PYTHON ./relax --time --system-tests N_state_model.test_populations; fi

cache: pip
git:
  depth: 10

notifications:
  # https://docs.travis-ci.com/user/notifications/#configuring-email-notifications
  # Pull Request builds do not trigger email notifications.
  email:
    recipients:
      - nmr-relax-devel@lists.sourceforge.net
    on_success: change # default: change (always, never, change)
    on_failure: always # default: always
