% The how to use relax chapter.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{How to use relax}


% The prompt.
%~~~~~~~~~~~~

\section{The prompt}

The primary interface of relax is the prompt.  After typing \texttt{`relax'} within a terminal, you will be presented with

\example{relax>}

This is the Python prompt which has been tailored specifically for relax.  You will hence have full access, if necessary, to the power of the Python\index{Python} programing language to manipulate your data.  You can for instance type

\example{relax> print "Hello World"}

the result being

\begin{exampleenv}
relax> print "Hello World" \\
Hello World \\
relax>
\end{exampleenv}

Or, using relax as a calculator

\begin{exampleenv}
relax> (1.0 + (2 * 3))/10 \\
0.69999999999999996 \\
relax>
\end{exampleenv}



% Python.
%~~~~~~~~

\section{Python}

\index{Python|textbf}
relax has been designed such that knowledge about Python is not required to be able to fully use the program.  A few basics, though, will aid in understanding relax.

A number of simple programming axioms includes that of strings\index{string}, integers\index{integer}, floating point numbers\index{floating point number}, and lists\index{list}.  A string is text and within Python (as well as relax) this is delimited by either single or double quotes.  An integer is a number with no decimal point while a float is a number with a decimal point.  A list in Python (called an array in other languages) is a list of anything separated by commas and delimited by square brackets, an example is [0, 1, 2, `a', 1.2143235].

Probably the most important detail is that functions in Python require brackets around their arguments.  For example

\example{relax> minimise()}

will commence minimisation\index{minimisation} however

\example{relax> minimise}

will do nothing.

The arguments to a function are simply a comma separated list within the brackets of the function.  For example to save the program's current state, type

\example{relax> state.save(`save', force=1)}

Two types of arguments exist in Python\index{Python|textbf}, standard arguments and keyword arguments.  The majority of arguments you will encounter within relax are keyword arguments however you may, in rare cases, encounter a non-keyword argument.  For these standard arguments, just type the values in, although they must be in the correct order.  Keyword arguments consist of two parts, the key and the value.  For example the key may be \texttt{file} while the value you would like to supply is \texttt{`R1.out'}.  Various methods exist for supplying this argument.  Firstly you could simply type \texttt{`R1.out'} into the correct position in the argument list.  Secondly you can type \texttt{file=`R1.out'}.  The power of this second option is that argument order is unimportant.  Therefore if you would like to change the default value of the very last argument, you don't have to supply values for all other arguments.  The only catch is that standard arguments must come before the keyword arguments.



% User functions.
%~~~~~~~~~~~~~~~~

\section{User functions}

\index{user functions|textbf}
For standard data analysis, a large number of specially tailored functions called `user functions' have been implemented.  These are accessible from the relax prompt by simply typing the name of the function.  An example is \texttt{`help()'}\index{help system}.  An alphabetical listing of all accessible user functions together with full descriptions is presented later within this manual.

A few special objects which are available within the prompt are not actually functions.  These objects do not require brackets at their end for them to function.  For example to exit relax type

\example{relax> exit}

Another special object is that of the function class\index{function class}.  This object is simply a container which holds a number of user functions.  You can access the user function within the class by typing the name of the class, then a dot \texttt{`.'}, followed by the name of the user function.  An example is the user function for reading relaxation data out of a file and loading the data into relax.  The function is called \texttt{`read'} while the class is called \texttt{`relax\_data'}.  To execute the function, type something like

\example{relax> relax\_data.read(name, `R1', `600', 600.0 * 1e6, `r1.600.out')}

The relax prompt, on first usage, can be quite daunting.  Two features exist, however, to increase the usability of the prompt -- the help system and tab completion



% The help system.
%~~~~~~~~~~~~~~~~~

\section{The help system}

\index{help system|textbf}
For assistance in using a function, simply type

\example{help(function)}

In addition to functions, if

\example{help(object)}

is typed, the help for the python object is returned.  This system is similar to the help function built into the python interpreter, which has been renamed to \texttt{help\_python}, with the interactive component removed.  For the interactive python help system, type

\example{help\_python()}




% Tab completion.
%~~~~~~~~~~~~~~~~

\section{Tab completion}

\index{tab completion|textbf}
Tab completion is implemented to prevent insanity as the function names can be quite long -- a deliberate feature to improve usability.  The behaviour of the tab completion is very similar to that of the bash prompt.

Not only is tab completion useful for preventing RSI, but it can also be used for finding out what functions are available.  To begin with if you hit the [TAB] key without typing any text, all available functions will be listed (along with function classes\index{function class} and other python objects).  This extends to the exploration of user functions\index{user functions} within a function class\index{function class}.  For example, to list the user functions within the function class \texttt{`model\_free'}, type

\example{relax> model\_free.}

The dot character at the end is essential.  After hitting the [TAB] key, you should see something like

\begin{exampleenv}
relax> model\_free. \\
model\_free.\_\_class\_\_ \\
model\_free.\_\_doc\_\_ \\
model\_free.\_\_init\_\_ \\
model\_free.\_\_module\_\_ \\
model\_free.\_\_relax\_\_ \\
model\_free.\_\_relax\_help\_\_ \\
model\_free.copy \\
model\_free.create\_model \\
model\_free.delete \\
model\_free.remove\_tm \\
model\_free.select\_model \\
relax> model\_free.
\end{exampleenv}

All the objects beginning with an underscore are ``hidden'', they contain information about the function class\index{function class} and should be ignored.  From the listing the user functions\index{user functions} \texttt{`copy'}, \texttt{`create\_model'}, \texttt{`delete'}, \texttt{`remove\_tm'}, and \texttt{`select\_model'} contained within \texttt{`model\_free'} are all visible.



% The `run'.
%~~~~~~~~~~~

\section{The `run'}

\index{run|textbf}
Within relax, the majority of operations are assigned to a special construct called a `run'.  For example, to load relaxation data into the program it must be committed to a pre-created `run'.  Within one instance of relax, multiple runs can be created and various operations performed in sequence on these runs.  This is useful for operations such as model selection whereby the function `model\_selection' can operate on a number of runs corresponding to different models and then assign the results to a newly created run.

The flow of data through relax can be thought of as travelling through pipes -- each pipe is synonymous with a run.  User functions\index{user functions} exist to transfer data between these pipes, while other functions combine data from multiple pipes into one or vice versa.  The simplest invocation of relax would be the creation of a single run and with the data being processed as it is passing through this pipe.

The primary method for creating a run is through the user function\index{user functions} \texttt{`run.create'}.  For example

\example{relax> run.create(`m1', `mf')}

will create a run called \texttt{`m1'}.  The run is also associated with a type which, in this case, is model-free analysis.  The following is a table of all the types which can be assigned to a run.

\begin{center}
\begin{tabular}{ll}
\toprule

Run type                & Description \\

\midrule

\texttt{`jw'}           & Reduced spectral density mapping \\
\texttt{`mf'}           & Model-free data analysis \\
\texttt{`noe'}          & Steady state NOE calculation \\
\texttt{`relax\_fit'}   & Relaxation curve fitting \\
\texttt{`srls'}         & SRLS analysis \\

\bottomrule
\end{tabular}
\end{center}

Currently only the NOE calculation, model-free analysis, and reduced spectral density mapping features of relax are implemented (if this documentation is out of date, then you may be able to do a lot more).



% Scripting.
%~~~~~~~~~~~

\section{Scripting}

\index{scripting|textbf}
What ever is done within the prompt is also accessible through scripting.  Just type your commands into a text file and then at the terminal type

\example{\$ relax your\_script}

An example of a simple script which will minimise the model-free model `m4' after loading six relaxation data sets is

\begin{exampleenv}
\# Create the run. \\
name = `m4' \\
run.create(name, `mf') \\
 \\
\# Nuclei type \\
nuclei(`N') \\
 \\
\# Load the sequence. \\
sequence.read(name, `noe.500.out') \\
 \\
\# Load the relaxation data. \\
relax\_data.read(name, `R1', `600', 600.0 * 1e6, `r1.600.out') \\
relax\_data.read(name, `R2', `600', 600.0 * 1e6, `r2.600.out') \\
relax\_data.read(name, `NOE', `600', 600.0 * 1e6, `noe.600.out') \\
relax\_data.read(name, `R1', `500', 500.0 * 1e6, `r1.500.out') \\
relax\_data.read(name, `R2', `500', 500.0 * 1e6, `r2.500.out') \\
relax\_data.read(name, `NOE', `500', 500.0 * 1e6, `noe.500.out') \\
 \\
\# Setup other values. \\
diffusion\_tensor.set(name, (2e-8, 1.3, 60, 290), param\_types=1, axial\_type=`prolate', fixed=1) \\
value.set(name, 1.02 * 1e-10, `bond\_length') \\
value.set(name, -160 * 1e-6, `csa') \\
 \\
\# Select a preset model-free model. \\
model\_free.select\_model(run=name, model=name) \\
 \\
\# Grid search. \\
grid\_search(name, inc=11) \\
 \\
\# Minimise. \\
minimise(`newton', run=name) \\
 \\
\# Finish. \\
results.write(run=name, file=`results', force=1) \\
state.save(`save', force=1)
\end{exampleenv}

Scripting is much more powerful than the prompt as advanced Python\index{Python} programming can be employed (see the file `full\_analysis.py' in the `sample\_scripts' directory for an example).



% Sample scripts.
%~~~~~~~~~~~~~~~~

\section{Sample scripts}

\index{scripting!sample scripts}
A few sample scripts have been provided in the directory `sample\_scripts'.  These can be used as a good starting point for using relax.



% The GUI.
%~~~~~~~~~

\section{The GUI}

\index{GUI}
relax has been designed primarily for scripting and, as such, no graphical user interface (GUI) currently exists.  The internal structure of the program has been specifically designed so any type of control mechanism can be easily added, including a GUI, therefore in the future one may be written.  A GUI will, however, detract from the power and flexibility inherent in the control by scripting.



% Access to the internals of relax.
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\section{Access to the internals of relax}

For highly advanced Python\index{Python} scripting or control of relax, almost every part of relax has been designed in an object oriented fashion.  If you would like to play with internals of the program, the entirety of relax is accessible within the object called \texttt{`self.relax'}.  To access the raw objects within relax which contain the program data, all data is stored within the object called \texttt{`self.relax.data'}.




% Usage of the name relax.
%~~~~~~~~~~~~~~~~~~~~~~~~~

\section{Usage of the name relax}

The program relax is so relaxed that the first letter should always be in lower case!
